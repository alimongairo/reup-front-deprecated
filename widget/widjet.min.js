function ipolWidjetController(e){var t={label:"iWidjet",params:{}};void 0===e&&(e={});for(var i in t)void 0===e[i]&&(e[i]=t[i]);var n=e.label,o=e.params;this.options={get:function(e){return c.get(e)},set:function(e,t){c.set(e,t)}},this.binders={add:function(e,t){a.addBind(e,t)},trigger:function(e,t){a.trigger(e,t)}},this.states={check:function(e){d.check(e)}},this.service={cloneObj:function(e){return r.cloneObj(e)},concatObj:function(e,t){return r.concatObj(e,t)},isEmpty:function(e){return r.isEmpty(e)},inArray:function(e,t){return r.inArray(e,t)},loadTag:function(e,t,i){r.loadTag(e,t,i)}},this.logger={warn:function(e){return s.warn(e)},error:function(e){return s.error(e)},log:function(e){return s.log(e)}};var s={warn:function(e){this.check("warn")&&console.warn(n+": ",e)},error:function(e){this.check("error")&&console.error(n+": ",e)},log:function(e){if(this.check("log"))if("object"==typeof e){console.log(n+": ");for(var t in e)console.log(t,e[t])}else console.log(n+": ",e)},check:function(e){var t=!1;switch(e){case"warn":t=c.check(!0,"showWarns");break;case"error":t=c.check(!0,"showErrors");break;case"log":t=c.check(!0,"showLogs")}return t&&c.check(!1,"hideMessages")}},r={cloneObj:function(e){var t=!1;if("object"!=typeof e)return t;if(1===arguments.length){t={};for(var i in e)t[i]=e[i]}else{t=[];for(var i in e)t.push(e[i])}return t},concatObj:function(e,t){if("object"==typeof e&&"object"==typeof t)for(var i in t)e[i]=t[i];return e},isEmpty:function(e){var t=!0;if("object"==typeof e)for(var i in e){t=!1;break}else t=e;return t},inArray:function(e,t){return t.filter(function(t){return t==e}).length},loadTag:function(e,t,i){var n=!1;void 0===t||"script"===t?((n=document.createElement("script")).src=e,n.type="text/javascript",n.language="javascript"):((n=document.createElement("link")).href=e,n.rel="stylesheet",n.type="text/css");document.getElementsByTagName("head")[0].appendChild(n),void 0!==i&&(n.onload=i,n.onreadystatechange=function(){"complete"!==this.readyState&&"loaded"!==this.readyState||n.onload()})}},c={self:this,options:{showWarns:{value:!0,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},showErrors:{value:!0,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},showLogs:{value:!0,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},hideMessages:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"}},check:function(e,t,i){var n=this.get(t);return null===n?null:void 0===i?e===n:e==n},get:function(e){return void 0!==this.options[e]?this.options[e].value:(s.warn('Undefined option "'+e+'"'),null)},set:function(e,t){if(void 0===this.options[t])s.warn("Undefined option to set : "+t);else if("function"!=typeof this.options[t].check||this.options[t].check.call(this.self,e))this.options[t].value=e;else{var i=!(void 0===this.options[t].hint||!this.options[t].hint)&&": "+this.options[t].hint;s.warn("Incorrect setting value ("+e+") for option "+t+i)}},iniSetter:function(e,t){for(var i in c.options)c.options[i].setting===t&&void 0!==e[i]&&c.set(e[i],i)}},a={events:{onStart:[]},trigger:function(e,t){if(void 0===this.events[e])s.error("Unknown event "+e);else if(this.events[e].length>0)for(var i in this.events[e])this.events[e][i](t)},iniSetter:function(e){for(var t in this.events)if(this.events.hasOwnProperty(t)&&void 0!==e[t])if("object"==typeof e[t])for(var i in e[t])this.addBind(e[t][i],t);else this.addBind(e[t],t)},addBind:function(e,t){"function"==typeof e?this.events[t].push(e):s.warn('The callback "'+e+'" for '+t+" is not a function")}},d={self:this,states:{start:{_start:!1}},check:function(e){var t=!1;for(var i in this.states){for(var n in this.states[i])n===e&&(this.states[i][n]=!0,t=i);if(t)break}if(t){var r=!0;for(var a in this.states[t])if(!this.states[t][a]){r=!1;break}r&&void 0!==l[t]&&(c.iniSetter(o,t),l[t].call(this.self,o))}else"started"===e?s.error("No callbacks for starting"):s.error("Unknown state of loading: "+e)}},l={start:function(e){a.iniSetter(e),a.trigger("onStart"),d.check("started")}},p={options:"object",states:"object",loaders:"funciton",stages:"object",events:"string"};for(var i in p)if(void 0!==e[i])for(var g in e[i])if({}.hasOwnProperty.call(e[i],g))if(typeof e[i][g]!==p[i])s.error("Illegal "+i+' "'+g+'": '+e[i][g]);else switch(i){case"options":c.options[g]=r.cloneObj(e.options[g]);break;case"states":d.states[g]=r.cloneObj(e.states[g]);break;case"loaders":l[g]=e.loaders[g];break;case"events":a.events[e.events[g]]=[];break;case"stages":"object"!=typeof e.stages[g].states||"function"!=typeof e.stages[g].function?s.error('Illegal stage "'+g+'": '+e[i][g]):(d.states[g]=r.cloneObj(e.stages[g].states),l[g]=e.stages[g].function)}d.check("_start")}function ISDEKWidjet(e){function t(){void 0===o.incrementer&&(o.incrementer=0),"function"!=typeof ymaps.geocode?o.incrementer++>50?o.logger.error("Unable to load ymaps"):window.setTimeout(t,500):n.onYmapsInited()}if(!e.path){var i=document.getElementById("ISDEKscript").src;i=i.substring(0,i.indexOf("widjet.js"))+"scripts/",e.path=i}e.servicepath||(e.servicepath=e.path+"service.php"),e.templatepath||(e.templatepath=e.path+"template.php"),e.currency||(e.currency="RUB");var n={onJSPCSSLoad:function(){o.states.check("JSPCSS")},onStylesLoad:function(){o.states.check("JSPCSS"),o.states.check("styles")},onIPJQLoad:function(){o.states.check("jquery")},onJSPJSLoad:function(){o.states.check("JSPJS")},onPVZLoad:function(){o.states.check("PVZ")},onDataLoad:function(){o.states.check("data")},onLANGLoad:function(){o.states.check("lang")},onYmapsLoad:function(){o.states.check("ymaps")},onYmapsReady:function(){o.states.check("mapsReady")},onYmapsInited:function(){o.states.check("mapsInited")},onCityFrom:function(){o.states.check("cityFrom")}},o=new ipolWidjetController({label:"ISDEKWidjet",options:{path:{value:e.path,check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (url)"},servicepath:{value:e.servicepath,check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (url)"},templatepath:{value:e.templatepath,check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (url)"},country:{value:"all",check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (countryname)"},lang:{value:"rus",check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (laguage name)"},link:{value:e.link,check:function(e){return!1===e||ipjq("#"+e).length>0},setting:"afterJquery",hint:"No element whit this id to put the widjet"},defaultCity:{value:e.defaultCity,check:function(e){return!1!==this.city.check(e)},setting:"dataLoaded",hint:"Default City wasn't founded"},choose:{value:!0,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},hidedress:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},hidecash:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},hidedelt:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},popup:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},region:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},detailAddress:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},apikey:{value:"f4e034c2-8c37-4168-8b97-99b6b3b268d7",check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (apikey)"},goods:{value:!1,check:function(e){if("object"!=typeof e)return!1;if(void 0!==e.width)return!1;for(var t in e)if(!(void 0!==e[t].length&&e[t].length&&void 0!==e[t].width&&e[t].width&&void 0!==e[t].height&&e[t].height&&void 0!==e[t].weight&&e[t].weight))return!1;return!0},setting:"start",hint:"Value must be an array of objects of type {length:(float),width:(float),height(float),weight(float)}"},cityFrom:{value:e.cityFrom,check:function(e){return!1!==this.city.check(e)},setting:"dataLoaded",hint:"City From wasn't founded"},currency:{value:e.currency,check:function(e){return-1!==["RUB","KZT","USD","EUR","GBP","CNY","BYN","UAH","KGS","AMD","TRY","THB","KRW","AED","UZS","MNT"].indexOf(e)},setting:"start",hint:"Currency wasn't founded"}},events:["onChoose","onChooseProfile","onChooseAddress","onReady","onCalculate"],stages:{mainInit:{states:{started:!1},function:function(){this.service.loadTag(this.options.get("path")+"ipjq.js","script",n.onIPJQLoad);var e="rus"==this.options.get("lang")?"ru_RU":"en_GB";this.service.loadTag("https://api-maps.yandex.ru/2.1/?apikey="+this.options.get("apikey")+"&lang="+e,"script",n.onYmapsLoad),this.service.loadTag(this.options.get("path")+"style.css","link",n.onStylesLoad)}},afterJquery:{states:{jquery:!1},function:function(){this.service.loadTag(this.options.get("path")+"jquery.mCustomScrollbar.concat.min.js","script",n.onJSPJSLoad),ipjq.getJSON(o.options.get("servicepath"),{isdek_action:"getPVZ",country:this.options.get("country"),lang:this.options.get("lang")},r.parsePVZFile),ipjq.getJSON(o.options.get("servicepath"),{isdek_action:"getLang",lang:this.options.get("lang")},d.write)}},ymapsBinder1:{states:{ymaps:!1},function:function(){ymaps.ready(n.onYmapsReady())}},ymapsBinder2:{states:{mapsReady:!1},function:function(){t()}},dataLoaded:{states:{JSPCSS:!1,JSPJS:!1,PVZ:!1,styles:!1,lang:!1},function:function(){n.onDataLoad(),o.options.get("cityFrom")?ipjq.getJSON(o.options.get("servicepath"),{isdek_action:"getCity",city:o.options.get("cityFrom")},function(e){void 0===e.error?c.cityFrom=e.id:o.logger.warn("City from was't found "+e.error),n.onCityFrom("onCityFrom")}):n.onCityFrom("onCityFrom")}},ready:{states:{data:!1,mapsInited:!1,cityFrom:!1},function:function(){"auto"!=o.options.get("defaultCity")&&r.city.set(o.options.get("defaultCity")),p.readyA=!0,p.html.loadCityList(r.city.collection),o.popupped?o.loadedToAction=!0:o.finalAction()}}},params:e});o.popupped=!1,o.loadedToAction=!1,o.finalActionCalled=!1,o.loaderHided=!1,o.finalAction=function(){!0!==o.finalActionCalled&&(o.finalActionCalled=!0,p.controller.loadCity(),this.sdekWidgetEvents(),this.binders.trigger("onReady"))},o.hideLoader=function(){o.loaderHided||(o.loaderHided=!0,ipjq(l.get("PRELOADER")).fadeOut(300),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search, .CDEK-widget__sidebar, .CDEK-widget__logo").removeClass("CDEK-widget__inaccessible"))};var s={blocks:{},getBlock:function(e,t){if(void 0!==s.blocks[e]){if(_tmpBlock=s.blocks[e],"object"==typeof t)for(keyVal in t)_tmpBlock=_tmpBlock.replace(new RegExp("#"+keyVal+"#","g"),t[keyVal]);return _tmpBlock=l.replaceAll(d.replaceAll(_tmpBlock)),_tmpBlock}return""},save:function(e){s.blocks=e,p.html.place()}},r={regions:{collection:{},cityes:{},map:{}},city:{indexOfSome:function(e,t){for(keyI in t)if(t[keyI]==e)return keyI;return!1},collection:{},collectionFull:{},current:!1,get:function(){return this.current},set:function(e,t=!1){return this.checkCity(e)?!(void 0===this.collection[e]&&!t&&!(e=this.indexOfSome(e,this.collection)))&&(this.current=e,e):(o.logger.error("Unknown city: "+e),!1)},checkCity:function(e){return void 0!==this.collection[e]||this.indexOfSome(e,this.collection)>-1},getName:function(e){return!!this.checkCity(e)&&(void 0===this.collection[e]&&(e=this.indexOfSome(e,this.collection)),this.collection[e])},getFullName:function(e){return!!this.checkCity(e)&&(void 0===this.collectionFull[e]&&(e=this.indexOfSome(e,this.collectionFull)),this.collectionFull[e])},getId:function(e){return!!this.checkCity(e)&&(void 0===this.collection[e]&&(e=this.indexOfSome(e,this.collection)),e)}},PVZ:{collection:{},bycoord:{},bycoordCur:0,check:function(e){return r.city.checkCity(e)&&void 0!==this.collection[e]},getCityPVZ:function(e){if(this.check(e))return this.collection[e];o.logger.error("No PVZ in city "+e)},getRegionPVZ:function(e){if(this.check(e)){let t={},i=r.regions.cityes[e],n=[];return n.push(...r.regions.map[i]),81===i&&n.push(...r.regions.map[9]),9===i&&n.push(...r.regions.map[81]),82===i&&n.push(...r.regions.map[26]),26===i&&n.push(...r.regions.map[82]),n.forEach((e,i,n)=>{var o=r.PVZ.collection[e];for(let e in o)t[e]=o[e]}),t}o.logger.error("No PVZ in city "+e)},getCurrent:function(){return o.options.get("region")?this.getRegionPVZ(r.city.current):this.getCityPVZ(r.city.current)}},address:{current:!1,get:function(){return r.address.current},set:function(e){r.address.current=e},fill:function(e){r.address.set(e)}},parsePVZFile:function(e){if(void 0===e.pvz){var t="Unable to load list of PVZ : ";if(void 0===e.pvz){for(var i in e.error)t+=e.error[i]+", ";t=t.substr(0,t.length-2)}else t+="unknown error.";o.logger.error(t)}else{void 0!==e.pvz.REGIONS&&(r.regions.collection=e.pvz.REGIONS,r.regions.cityes=e.pvz.CITYREG,r.regions.map=e.pvz.REGIONSMAP);for(var s in e.pvz.PVZ)r.PVZ.collection[s]=e.pvz.PVZ[s],void 0!==e.pvz.CITY[s]&&void 0===r.city.collection[s]&&(r.city.collection[s]=e.pvz.CITY[s],r.city.collectionFull[s]=e.pvz.CITYFULL[s]);n.onPVZLoad()}}},c={bad:!1,profiles:{courier:{price:0,currency:"RUB",term:0,tarif:!1},pickup:{price:0,currency:"RUB",term:0,tarif:!1}},history:[],defaultGabs:{length:20,width:30,height:40,weight:1},cityFrom:!1,binder:{},calculate:function(e=!1){if(this.cityFrom){let i=this.history.findIndex(e=>e.code===parseInt(r.city.current)&&"courier"===e.type&&e.weight===a.getWeight()),n=this.history.findIndex(e=>e.code===parseInt(r.city.current)&&"pickup"===e.type&&e.weight===a.getWeight());if(-1!==i&&-1!==n){for(var t in this.profiles){let e="pickup"===t?n:i;-1!==e&&(this.profiles[t].price=this.history[e].price,this.profiles[t].term=this.history[e].term,this.profiles[t].tarif=this.history[e].tarif)}o.binders.trigger("onCalculate",{profiles:o.service.cloneObj(c.profiles),city:r.city.current,cityName:r.city.getName(r.city.current)})}else{let t=Date.now();this.binder[parseInt(r.city.current)]={};for(let i in this.profiles)this.profiles[i].price=null,this.profiles[i].term=null,this.profiles[i].tarif=!1,this.request(i,t,e)}}else o.logger.warn("No city from given: calculation is impossible")},request:function(e,t,i=!1){var n={type:e};if(void 0!==a.get()[0]){var s=a.get();n.goods=[];for(var d in s)n.goods.push(s[d])}else n.goods=[this.defaultGabs];n.cityFromId=this.cityFrom,n.cityToId=i?r.city.get():r.city.getId(r.city.current),n.currency=o.options.get("currency"),void 0!==t&&(n.timestamp=t),r.city.current&&ipjq.getJSON(o.options.get("servicepath"),{isdek_action:"calc",shipment:n},c.onCalc)},onCalc:function(e){if(void 0!==e.error){c.bad=!0;var t="",i=!1;for(var n in e.error)if("object"==typeof e.error[n])for(var s in e.error[n])t+=e.error[n][s].text+" ("+e.error[n][s].code+"), ",3===e.error[n][s].code&&(i=!0);else t+=e.error[n]+", ";i?(o.logger.warn("Troubles while calculating: "+t.substring(0,t.length-2)),void 0!==e.type&&(c.profiles[e.type].price=!1,c.profiles[e.type].term=!1,c.profiles[e.type].tarif=!1)):o.logger.error("Error while calculating: "+t.substring(0,t.length-2))}else c.bad=!1,c.profiles[e.type].price=e.result.price,c.profiles[e.type].currency=e.result.currency,c.profiles[e.type].term=e.result.deliveryPeriodMax===e.result.deliveryPeriodMin?e.result.deliveryPeriodMin:e.result.deliveryPeriodMin+"-"+e.result.deliveryPeriodMax,c.profiles[e.type].tarif=void 0!==e.result.tarif?e.result.tarif:e.result.tariffId,c.history.push({code:parseInt(r.city.current),weight:a.getWeight(),type:e.type,price:e.result.price,currency:e.result.currency,term:c.profiles[e.type].term,tarif:c.profiles[e.type].tarif});if(void 0!==e.type&&void 0!==c.binder[parseInt(r.city.current)]){c.binder[parseInt(r.city.current)][e.type]=!0;for(var n in c.profiles)if(void 0===c.binder[parseInt(r.city.current)][n])return!1;o.binders.trigger("onCalculate",{profiles:o.service.cloneObj(c.profiles),city:r.city.current,cityName:r.city.getName(r.city.current)})}}},a={collection:"object"==typeof o.options.get("goods")?o.options.get("goods"):[],add:function(e){"object"!=typeof e||void 0===e.length||void 0===e.width||void 0===e.height||void 0===e.weight?o.logger.error("Illegal item "+e):(this.collection.push({length:e.length,width:e.width,height:e.height,weight:e.weight}),o.calculate())},reset:function(){this.collection=[]},get:function(){return o.service.cloneObj(this.collection)},getWeight:function(){return this.collection.reduce((e,t)=>e+t.weight,0)}},d={collection:{},replaceAll:function(e){for(langKey in this.collection)e=e.replace(new RegExp("#"+langKey+"#","g"),this.collection[langKey]);return e},get:function(e){return void 0!==this.collection[e]?this.collection[e]:(o.logger.warn("No lang string with key "+e),"")},write:function(e){if(ipjq.getJSON(o.options.get("templatepath"),{},s.save),void 0===e.LANG){var t="Unable to load land-file : ";if(void 0!==e.error){for(var i in e.error)t+=e.error[i]+", ";t=t.substr(0,t.length-2)}else t+="unknown error.";o.logger.error(t)}else d.collection=o.service.cloneObj(e.LANG),n.onLANGLoad()}},l={WID:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<5;i++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}()+"_",options:{MAP:"SDEK_map",PRELOADER:"preloader"},replaceAll:function(e){for(optKey in this.options)e=e.replace(new RegExp("#"+optKey+"#","g"),this.WID+this.options[optKey].replace("#",""));return e.replace(new RegExp("#WID#","g"),this.WID)},get:function(e){return void 0!==this.options[e]?"#"+this.WID+this.options[e]:"#"+this.WID+e}},p={readyA:!1,html:{get:function(){return s.getBlock("widget",{CITY:o.options.get("defaultCity")})},makeADAPT:function(){if(!o.options.get("link")){var e=ipjq(l.get("cdek_widget_cnt")).outerHeight();e<476||ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box, .mCustomScrollBox").css("max-height","auto"),e<ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__box").outerHeight()+56?ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").css("max-height",e-56+"px"):ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").css("max-height",ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__box").outerHeight()+"px")}},makeFULLSCREEN:function(){this.makeADAPT(),ipjq(window).resize(this.makeADAPT())},place:function(){var e=this.get();o.options.get("link")?ipjq("#"+o.options.get("link")).html(e):o.options.get("popup")?(o.popupped=!0,e=s.getBlock("popup",{WIDGET:e}),ipjq("body").append(e),this.makeFULLSCREEN()):((e=ipjq(e)).css("position","fixed"),e.css("top",0),e.css("left",0),e.css("z-index",1e3),ipjq("body").append(e),this.makeFULLSCREEN()),o.options.get("choose")||ipjq(l.get("cdek_widget_cnt")).addClass("nochoose");var t=s.getBlock("sidebar");if(o.options.get("hidecash")){(i=[]).push(t.slice(0,1476)),i.push(t.slice(2693)),t=i.join("")}if(o.options.get("hidedress")){var i=[];i.push(t.slice(0,o.options.get("hidecash")?1476:2693)),i.push(t.slice(t.indexOf("<hr>"))),t=i.join("")}o.options.get("hidedelt")&&ipjq(l.get("cdek_delivery_types")).hide(),ipjq(l.get("sidebar")).html(t),this.makeADAPT()},loadedCities:[],setDefaultCities(){const e=ipjq(l.get("city_list"));e.empty();this.loadedCities.slice(0,7).forEach(t=>{const i=s.getBlock("city",t);e.prepend(i)})},loadCityList:function(e){this.loadedCities=[];for(const t in e)this.loadedCities.push({CITYID:t,CITYNAME:e[t],CITY_DETAILS:void 0!==r.regions.collection[t]?r.regions.collection[t]:"&nbsp;"});this.setDefaultCities()},updatePrices:function(e){if(ipjq(l.get("cdek_widget_cnt")).find(l.get("cdek_delivery_types")+" div.CDEK-widget__delivery-type__item").remove(),void 0===e||0==e.length)ipjq(l.get("cdek_widget_cnt")).find(l.get("cdek_delivery_type_title span.CDEK_choose")).hide(),ipjq(l.get("cdek_widget_cnt")).find(l.get("cdek_delivery_type_title span.CDEK_no-avail")).show(),ipjq(l.get("cdek_widget_cnt")).find(l.get("cdek_delivery_type_none")).show();else{ipjq(l.get("cdek_widget_cnt")).find(l.get("cdek_delivery_type_title span.CDEK_choose")).show(),ipjq(l.get("cdek_widget_cnt")).find(l.get("cdek_delivery_type_title span.CDEK_no-avail")).hide(),ipjq(l.get("cdek_widget_cnt")).find(l.get("cdek_delivery_type_none")).hide();for(var t in e)switch(t){case"courier":case"pickup":c.bad&&!1===e[t].price||(_tmpBlock=s.getBlock("d_"+t,{SUMM:null===e[t].price?d.get("COUNTING"):e[t].price,CURR:null===e[t].price?"":d.get(e[t].currency),TIME:null===e[t].term?"":e[t].term,DAY:null===e[t].term?"":d.get("DAY")}),ipjq(l.get("cdek_delivery_types")).append(_tmpBlock))}}this.makeADAPT()},hideMap:function(){ipjq(l.get("MAP")).css("display","none"),ipjq(l.get("cdek_widget_cnt")).find("#SDEK_info").css("display","none")}},controller:{getCity:function(){return r.city.get()},loadCity:function(e){ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel-details__back").click(),void 0!==e&&1==e||this.calculate(),this.updatePrices(),p.ymaps.init(r.city.current)},selectCity:function(e){"object"==typeof e&&(e=e.data.name),void 0!==e&&e||(e=ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li").not(".no-active").first().data("cityid")),r.city.set(e),p.controller.loadCity(),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]").val(r.city.getName(e)),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li").removeClass("focus").addClass("no-active").parent("ul").removeClass("open"),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]")[0].blur(),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__button").attr("class","CDEK-widget__delivery-type__button"),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__item").removeClass("active"),setTimeout(function(){ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").removeClass("CDEK-widget__delivery-type_close")},1e3),p.ui.addressSearch.ifOn()&&p.ui.addressSearch.hide()},putCity:function(e){"object"==typeof e&&(e=e.data.name),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]").val(r.city.getName(e)),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li").removeClass("focus").addClass("no-active").parent("ul").removeClass("open")},updatePrices:function(){p.html.updatePrices({courier:c.profiles.courier,pickup:c.profiles.pickup})},calculate:function(e=!1){c.calculate(e)},chooseDeliveryType:function(){if(p.ui.addressSearch.ifOn()&&p.ui.addressSearch.hide(),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul").hasClass("open")){var e=ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul").find("li.focus");return 0!=e.length?p.controller.selectCity(e.find(".CDEK-widget__search-list__city-name").text()):p.controller.selectCity(),void setTimeout(function(){ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").removeClass("CDEK-widget__delivery-type_close")},1e3)}ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").removeClass("CDEK-widget__delivery-type_close")},choosePVZ:function(e){var t=ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__item:last");t.hasClass("active")||(t.attr("class","CDEK-widget__delivery-type__item").addClass("active"),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__item:first").attr("class","CDEK-widget__delivery-type__item").removeClass("active"),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__button").attr("class","CDEK-widget__delivery-type__button").addClass("CDEK-widget__delivery-type__button_pvz"));var i=r.PVZ.getCurrent();o.binders.trigger("onChoose",{id:e,PVZ:i[e],price:c.profiles.pickup.price,currency:c.profiles.pickup.currency,term:c.profiles.pickup.term,tarif:c.profiles.pickup.tarif,city:r.city.current,cityName:r.city.getName(r.city.current)}),o.options.get("link")||this.close()},chooseCOURIER:function(){o.binders.trigger("onChooseProfile",{id:"courier",city:r.city.current,cityName:r.city.getName(r.city.current),price:c.profiles.courier.price,currency:c.profiles.courier.currency,term:c.profiles.courier.term,tarif:c.profiles.courier.tarif}),p.ui.active||o.options.get("link")?p.ui.addressSearch.ifOn()&&(p.ui.addressSearch.show(),p.ui.addressSearch.fill()):this.close()},open:function(){o.options.get("link")?o.logger.error("This widjet is in non-floating mode - link is set"):p.ui.open()},close:function(){o.options.get("link")?o.logger.error("This widjet is in non-floating mode - link is set"):p.ui.close()}},ui:{currentmark:!1,markChozenPVZ:function(e){p.ymaps.selectMark(e.data.id)},choosePVZ:function(e){p.controller.choosePVZ(e.data.id)},addressSearch:{active:!1,getInput:function(){return ipjq(l.get("cdek_courier_address_place"))},ifOn:function(){return o.options.get("detailAddress")},show:function(){p.ui.addressSearch.active=!0,ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__courier-address__box").removeClass("CDEK-widget__courier-address__box_close")},hide:function(){p.ui.addressSearch.active=!1,p.ui.addressSearch.killBaloon(),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__courier-address__box").addClass("CDEK-widget__courier-address__box_close")},fill:function(){r.city.getName()&&p.ui.addressSearch.getInput().val(r.city.getName(p.controller.getCity())+", "),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__courier-address__button").addClass("allowed")},mapClick:function(e){p.ui.addressSearch.active&&void 0!==e&&(p.ymaps.centerAddr(e.geometry.getCoordinates()),p.ui.addressSearch.getInput().val(e.properties.get("text")),p.ui.addressSearch.makeBaloon(e.geometry.getCoordinates(),e.properties.get("text")))},search:function(){p.ymaps.getSearchAddress(p.ui.addressSearch.getInput().val(),p.ui.addressSearch.found)},found:function(e){p.ui.addressSearch.killBaloon(),p.ymaps.centerAddr(e.coords),p.ui.addressSearch.makeBaloon(e.coords,e.name)},baloon:!1,makeBaloon:function(e,t){p.ui.addressSearch.baloon=p.ymaps.makeBaloon(e,"<div class='CDEK-widget__baloon'>"+t+'<br><button class="CDEK-widget__choose" type="button" data-label="'+d.get("L_CHOOSE")+'">'+d.get("L_CHOOSE")+"</button></div>"),p.ui.addressSearch.baloon&&(p.ui.addressSearch.baloon.balloon.open(),window.setTimeout(function(){ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__baloon .CDEK-widget__choose").on("click",p.ui.addressSearch.clickBaloon)},500))},killBaloon:function(){p.ui.addressSearch.baloon&&p.ymaps.killBaloon(p.ui.addressSearch.baloon)},clickBaloon:function(){p.ui.addressSearch.killBaloon(),p.ui.addressSearch.choose()},choose:function(){r.address.fill(p.ui.addressSearch.getInput().val()),ipjq.getJSON(o.options.get("servicepath"),{isdek_action:"getCity",address:r.address.get()},function(e){void 0===e.error?r.city.get()==e.city.id?(p.ui.addressSearch.hide(),o.binders.trigger("onChooseAddress",{id:"courier",city:r.city.current,cityName:r.city.getName(r.city.current),price:c.profiles.courier.price,currency:c.profiles.courier.currency,term:c.profiles.courier.term,tarif:c.profiles.courier.tarif,address:r.address.get()}),o.options.get("link")||this.close()):(r.city.set(e.city.id,!0),ipjq(l.get("cdek_search_input")).val(e.city.city),p.html.updatePrices({courier:{price:null,term:null},pickup:{price:null,term:null}}),alert(d.get("ADDRESS_ANOTHER")),p.controller.calculate(!0),p.controller.chooseDeliveryType()):(alert(d.get("ADDRESS_WRONG")),o.logger.warn("City from was't found "+e.error))})}},open:function(){ipjq(l.get("CDEK_popup")).show(),o.loadedToAction?o.finalAction():o.popupped=!1,!1!==p.ymaps.map&&p.ymaps.map.container.fitToViewport(),this.active=!0},close:function(){this.active=!1,ipjq(l.get("CDEK_popup")).hide()}},ymaps:{map:!1,readyToBlink:!1,linker:l.get("MAP").replace("#",""),init:function(e){this.readyToBlink=!1;var t=this;0==e?ymaps.geolocation.get({}).then(function(i){for(var n=i.geoObjects.get(0).properties.get("metaDataProperty").GeocoderMetaData.Address.Components,s=n.length-1;s>=0&&("locality"!=n[s].kind||(e=n[s].name,e=e.replace(/город\s|поселок\sгородского\sтипа\s|поселок\s|посёлок\s|деревня\s|село\s/gi,""),r.city.set(e),!1===r.city.current));s--);if(0==r.city.current){n=i.geoObjects.get(0).geometry._coordinates;var c=100;for(var a in r.PVZ.collection)for(var d in r.PVZ.collection[a]){var g=r.PVZ.collection[a][d],u=Math.sqrt(Math.pow(g.cY-n[0],2)+Math.pow(g.cX-n[1],2));c>u&&(g,c=u,e=a)}0!=e?(r.city.set(e),e=r.city.getName(e)):(r.city.set("Москва"),e="Москва")}o.options.set(e,"defaultCity"),p.controller.calculate(),p.controller.updatePrices(),t.loadMap(r.city.current),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]").val(e)}):t.loadMap(r.city.current)},loadMap:function(e){var t=this;e=r.city.getFullName(e);let i={};ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button-point.active").length&&ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button-point.active").each(function(){i[ipjq(this).data("mtype")]=!0}),"object"!=typeof r.PVZ.getCurrent()?ymaps.geocode(e,{results:1}).then(function(e){var n=e.geoObjects.get(0).geometry.getCoordinates();t.map?(t.map.setCenter(n),t.map.setZoom(10)):t.makeMap({center:n}),t.placeMarks(i)}):t.placeMarks(i)},makeMap:function(e){if("object"!=typeof e&&(e={}),p.ymaps.map=new ymaps.Map(p.ymaps.linker,o.service.concatObj({zoom:10,controls:[]},e)),this.map.controls.add(new ymaps.control.ZoomControl,{float:"none",position:{left:12,bottom:70}}),p.ymaps.map.events.add("boundschange",o.hideLoader),p.ymaps.map.events.add("actionend",o.hideLoader),o.options.get("detailAddress")){p.ymaps.map.events.add("click",p.ymaps.getClickAddress);new ymaps.SuggestView(l.get("cdek_courier_address_place").substr(1))}},centerAddr:function(e){this.map.setCenter(e),this.map.setZoom(17)},clearMarks:function(){if(this.map.geoObjects.removeAll,1)do{var e=this.map;e.geoObjects.each(function(t){e.geoObjects.remove(t)})}while(e.geoObjects.getBounds());else this.map.geoObjects.removeAll()},placeMarks:function(e){let t=r.PVZ.getCurrent();if("object"!=typeof t?ipjq(l.get("sidebar")).hide():ipjq(l.get("sidebar")).show(),ipjq(l.get("panel")).find(l.get("pointlist")).html(""),ipjq(l.get("panel")).find(l.get("pointlist")).html(s.getBlock("panel_list")),_panelContent=ipjq(l.get("pointlist")).find(".CDEK-widget__panel-content"),"object"==typeof t){p.ymaps.clusterer=new ymaps.Clusterer({gridSize:50,preset:"islands#ClusterIcons",clusterIconColor:"#0a8c37",hasBalloon:!1,groupByCoordinates:!1,clusterDisableClickZoom:!1,maxZoom:11,zoomMargin:[45],clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1}),geoMarks=[];for(var i in t){if(void 0!==e){if(void 0!==e.dress&&1!=t[i].Dressing)continue;if(void 0!==e.cash&&1!=t[i].Cash)continue;if(void 0!==e.postamat&&1!=t[i].Postamat)continue}let n=o.options.get("path")+(1!=t[i].Postamat?"images/sdekActive.png":"images/postomatActive.png"),r=o.options.get("path")+(1!=t[i].Postamat?"images/sdekNActive.png":"images/postomatNActive.png");t[i].placeMark=new ymaps.Placemark([t[i].cY,t[i].cX],{},{iconLayout:"default#image",iconImageHref:n,iconImageSize:[30,40],iconImageOffset:[-10,-30]}),geoMarks.push(t[i].placeMark),t[i].placeMark.link=i,t[i].list_block=ipjq(s.getBlock("point",{P_NAME:t[i].Name,P_ADDR:t[i].Address,P_TIME:t[i].WorkTime.replace(new RegExp(",","g"),"<br/>")})),t[i].placeMark.listItem=t[i].list_block,t[i].placeMark.events.add(["balloonopen","click"],function(e){if(_prevMark=p.ui.currentmark,p.ui.currentmark=e.get("target"),"object"==typeof _prevMark)try{_prevMark.events.fire("mouseleave")}catch(e){}ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-burger:not(.active)").trigger("click"),p.ui.markChozenPVZ({data:{id:e.get("target").link,link:p.ui}})}),t[i].placeMark.events.add(["mouseenter"],function(e){ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel-content").mCustomScrollbar("scrollTo",e.get("target").listItem),e.get("target").listItem.addClass("CDEK-widget__panel-list__item_active"),e.get("target").options.set({iconImageHref:r})}),t[i].placeMark.events.add(["mouseleave"],function(e){p.ui.currentmark!=e.get("target")&&(e.get("target").listItem.removeClass("CDEK-widget__panel-list__item_active"),e.get("target").options.set({iconImageHref:n}))}),t[i].list_block.mark=t[i].placeMark,t[i].list_block.on("click",{mark:i},function(e){t[e.data.mark].placeMark.events.fire("click")}).on("mouseenter",{id:i,ifOn:!0,link:p.ymaps},p.ymaps.blinkPVZ).on("mouseleave",{id:i,ifOn:!1,link:p.ymaps},p.ymaps.blinkPVZ),_panelContent.append(t[i].list_block)}geoMarks.length>0?(p.ymaps.clusterer.add(geoMarks),_bounds=p.ymaps.clusterer.getBounds(),this.map?_bounds[0][0]==_bounds[1][0]?(this.map.setCenter(_bounds[0]),this.map.setZoom(10),p.ymaps.clearMarks(),this.map.geoObjects.add(p.ymaps.clusterer)):this.map.setBounds(p.ymaps.clusterer.getBounds(),{zoomMargin:45,checkZoomRange:!0,duration:500}).then(function(){p.ymaps.clearMarks(),this.map.geoObjects.add(p.ymaps.clusterer),this.map.getZoom()>12&&this.map.setZoom(12)},function(){p.ymaps.clearMarks(),this.map.geoObjects.add(p.ymaps.clusterer),this.map.getZoom()>12&&this.map.setZoom(12)},this):(_bounds[0][0]==_bounds[1][0]?this.makeMap({center:_bounds[0]}):(this.makeMap({bounds:_bounds}),this.map.setBounds(_bounds,{zoomMargin:45,checkZoomRange:!0,duration:500})),p.ymaps.clearMarks(),this.map.geoObjects.add(p.ymaps.clusterer),o.hideLoader())):(p.ymaps.clearMarks(),o.hideLoader())}ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel-content").mCustomScrollbar(),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").mCustomScrollbar(),this.readyToBlink=!0},makeUpCenter:function(e){var t=this.map.options.get("projection");return e=this.map.converter.globalToPage(t.toGlobalPixels(e,this.map.getZoom())),ww=ipjq(l.get("panel")).width(),ipjq(l.get("cdek_widget_cnt")).width()-ww>100&&(e[0]=e[0]+ww/2),e=t.fromGlobalPixels(this.map.converter.pageToGlobal(e),this.map.getZoom())},selectMark:function(e){var t=r.PVZ.getCurrent();if(parseInt(r.city.current)!==parseInt(t[e].CityCode)&&(r.city.set(parseInt(t[e].CityCode)),city=r.city.getName(t[e].CityCode),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]").val(city),c.calculate(),p.controller.updatePrices()),this.map.setCenter(p.ymaps.makeUpCenter([t[e].cY,t[e].cX])),_detailPanel=ipjq(l.get("panel")).find(l.get("detail_panel")),_detailPanel.html(""),_photoHTML="",void 0!==t[e].Picture)for(_imgIndex in t[e].Picture)_photoHTML+=s.getBlock("image_c",{D_PHOTO:t[e].Picture[_imgIndex]});_block=ipjq(s.getBlock("panel_details",paramsD={D_NAME:t[e].Name,D_ADDR:t[e].Address,D_TIME:t[e].WorkTime.replace(new RegExp(",","g"),"<br/>"),D_WAY:-1==t[e].AddressComment.search("http")?t[e].AddressComment:"",D_IMGS:_photoHTML})),""==paramsD.D_WAY&&_block.find(".CDEK-widget__way").remove(),""==paramsD.D_IMGS&&_block.find(".sdek_image_block").remove(),_block.find(l.get("choose_button")).on("click",{id:e},function(e){p.controller.choosePVZ(e.data.id)}),_detailPanel.html(_block),_detailPanel.find(".CDEK-widget__panel-content").mCustomScrollbar(),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list").css("left","-330px"),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel-details").css("right","0px")},blinkPVZ:function(e){if(e.data.link.readyToBlink){var t=r.PVZ.getCurrent();if(p.ui.currentmark==t[e.data.id].placeMark)return;e.data.ifOn?(e.data.link.clusterer.remove(t[e.data.id].placeMark),e.data.link.map.geoObjects.add(t[e.data.id].placeMark),t[e.data.id].placeMark.options.set({iconImageHref:o.options.get("path")+"images/sdekActive.png"})):(t[e.data.id].placeMark.options.set({iconImageHref:o.options.get("path")+"images/sdekNActive.png"}),e.data.link.map.geoObjects.remove(t[e.data.id].placeMark),e.data.link.clusterer.add(t[e.data.id].placeMark))}},getClickAddress:function(e){ymaps.geocode(e.get("coords"),{kind:"house"}).then(function(e){p.ui.addressSearch.mapClick(e.geoObjects.get(0))})},getSearchAddress:function(e,t){ymaps.geocode(e,{kind:"house"}).then(function(e){var i=e.geoObjects.get(0),n={name:i.properties.get("name"),descr:i.properties.get("description"),coords:i.geometry.getCoordinates()};return void 0!==t&&t(n),n})},makeBaloon:function(e,t){var i=new ymaps.Placemark(e,{balloonContent:t},{balloonCloseButton:!1,iconLayout:"default#image"});return p.ymaps.map.geoObjects.add(i),i},killBaloon:function(e){p.ymaps.map.geoObjects.remove(e)}}};return o.binders.add(p.controller.updatePrices,"onCalculate"),o.sdekSetPVZS=function(e){p.ymaps.clearMarks(),void 0===e?p.ymaps.placeMarks():p.ymaps.placeMarks(e)},o.chooseCourier=function(){p.controller.chooseCOURIER()},o.sdekWidgetEvents=function(){ipjq(".CDEK-widget__popup__close-btn").off("click").on("click",function(){ipjq(this).closest(".CDEK-widget__popup-mask").hide()}),ipjq(l.get("cdek_widget_cnt")).on("click",".CDEK-widget__sidebar-button",{widjet:o},function(){_this=ipjq(this),_this.toggleClass("active");var e=_this.attr("data-hint"),t=ipjq(l.get("cdek_widget_cnt")).find(e).outerWidth();if(_this.hasClass("CDEK-widget__sidebar-button-point"))if(ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button-point.active").length){var i={};ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button-point.active").each(function(){i[ipjq(this).data("mtype")]=!0}),o.sdekSetPVZS(i)}else o.sdekSetPVZS();else ipjq(l.get("cdek_widget_cnt")).find(e).css({right:-t,opacity:"0"}),_this.hasClass("CDEK-widget__sidebar-burger")&&(_this.hasClass("close")&&_this.removeClass("close"),_this.toggleClass("open"),_this.hasClass("open")||_this.addClass("close"),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel").hasClass("open")?_this.hasClass("active")?(ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel-contacts").fadeOut(600),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list, .CDEK-widget__panel-details").fadeIn(600),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button_phone").removeClass("active")):(ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list, .CDEK-widget__panel-details").fadeOut(600),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel").removeClass("open")):(ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel").addClass("open"),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list, .CDEK-widget__panel-details").fadeIn(600))),_this.hasClass("CDEK-widget__sidebar-button_phone")&&(ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel").hasClass("open")?_this.hasClass("active")?(ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list, .CDEK-widget__panel-details").fadeOut(600),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel-contacts").fadeIn(600),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-burger").removeClass("active").removeClass("open").addClass("close")):(ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel-contacts").fadeOut(600),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel").removeClass("open")):(ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel").addClass("open"),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel-contacts").fadeIn(600)))}).on("click",".CDEK-widget__choose",function(){ipjq(this).addClass("widget__loading")}),ipjq(l.get("cdek_widget_cnt")).on("mousemove",".CDEK-widget__sidebar-button",function(){if(!ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel").hasClass("open")){var e=ipjq(this).attr("data-hint");ipjq(l.get("cdek_widget_cnt")).find(e).css({right:"67px",opacity:"1"})}}).on("mouseleave",".CDEK-widget__sidebar-button",function(){var e=ipjq(this).attr("data-hint"),t=ipjq(l.get("cdek_widget_cnt")).find(e).outerWidth();ipjq(l.get("cdek_widget_cnt")).find(e).css({right:-t,opacity:"0"})}).on("hover",".CDEK-widget__panel-headline",function(){ipjq(this).outerWidth()<=ipjq(this).find("span").outerWidth()&&ipjq(this).addClass("hover-long")},function(){ipjq(this).hasClass("hover-long")&&ipjq(this).removeClass("hover-long")}),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button").each(function(e,t){var i=ipjq(t).attr("data-hint"),n=(ipjq(t).outerHeight()+-ipjq(l.get("cdek_widget_cnt")).find(i).outerHeight())/2+62*e,o=ipjq(l.get("cdek_widget_cnt")).find(i).outerWidth();ipjq(l.get("cdek_widget_cnt")).find(i).css({right:-o,top:n,opacity:"0"})}),ipjq(l.get("cdek_widget_cnt")).on("click",".CDEK-widget__panel-details__back",function(){ipjq(this).parents(".CDEK-widget__panel-details").css("right","-330px"),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list").css("left","0px")}).on("click",".CDEK-widget__panel-details__block-img",function(){var e=ipjq(this).find("img").attr("src"),t=ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__photo");t.find("img").attr("src",e),t.addClass("active")}).on("click",".CDEK-widget__photo",function(e){ipjq(e.target).is("img")||ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__photo").removeClass("active")}).on("focusin",".CDEK-widget__search-box input[type=text]",function(){ipjq(this).val(""),p.html.setDefaultCities(),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").hasClass("CDEK-widget__delivery-type_close")?ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul").addClass("open").find("li").removeClass("no-active"):(ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").addClass("CDEK-widget__delivery-type_close"),setTimeout(function(){ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul").addClass("open").find("li").removeClass("no-active")},1e3))}).on("click",".CDEK-widget__search-list ul li",function(){p.controller.selectCity(ipjq(this).data("cityid"))}).on("keydown",".CDEK-widget__search-box input[type=text]",function(e){var t=ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li:not(.no-active)"),i=t.filter(".focus");40===e.keyCode&&(0==i.length?t.first().addClass("focus"):(i.removeClass("focus"),0!=i.nextAll().filter(":not(.no-active)").eq(0).length?i.nextAll().filter(":not(.no-active)").eq(0).addClass("focus"):t.first().addClass("focus"))),38===e.keyCode&&(0==i.length?t.last().addClass("focus"):(i.removeClass("focus"),0!=i.prevAll().filter(":not(.no-active)").eq(0).length?i.prevAll().filter(":not(.no-active)").eq(0).addClass("focus"):t.last().addClass("focus")))}).on("keyup",".CDEK-widget__search-box input[type=text]",function(e){const t=ipjq(this).val();let i;try{i=new RegExp("^("+t+")+.*","i")}catch(e){i=""}var n=ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li");const o=ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul");if(13!==e.keyCode)if(""!==i){const e=[];o.children().each((t,i)=>{e.push(i.getAttribute("data-cityid"))});const t=p.html.loadedCities.filter(e=>i.test(e.CITYNAME.replace(/[^\wа-яё\s-]+/gi,""))).slice(0,7),n=t.map(e=>e.CITYID);if(0===t.length?o.removeClass("open"):o.hasClass("open")||o.addClass("open"),e.length===n.length&&e.sort().toString()===n.sort().toString())return;o.empty(),t.forEach((e,t)=>{const i=s.getBlock("city",e),n=ipjq(i);n.removeClass("no-active"),o.prepend(n)})}else n.removeClass("no-active");else{var r=n.not(".no-active").filter(".focus");0==r.length?p.controller.selectCity():(p.controller.selectCity(r.find(".CDEK-widget__search-list__city-name").text()),r.removeClass("focus"))}}).on("click",function(e){0==ipjq(e.target).closest(".CDEK-widget__search").length&&0!=ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li").not(".no-active").length&&p.controller.putCity(p.controller.getCity())}).on("click",".CDEK-widget__delivery-type__item",{widjet:o},function(e){var t=ipjq(this).attr("data-delivery-type");ipjq(this).hasClass("active")||(ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__item.active").removeClass("active"),ipjq(this).addClass("active"),ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__button").attr("class","CDEK-widget__delivery-type__button").addClass("CDEK-widget__delivery-type__button_"+t)),"courier"==t&&e.data.widjet.chooseCourier(),ipjq(this).parents(".CDEK-widget__delivery-type").addClass("CDEK-widget__delivery-type_close")}).on("click",".CDEK-widget__delivery-type__button",function(){p.controller.chooseDeliveryType()}).on("click",".CDEK-widget__courier-address__button",function(){p.ui.addressSearch.search()})},o.city={get:function(){return r.city.current},set:function(e){let t=r.city.set(e);!1!==t&&ipjq(l.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]").val(r.city.getName(t)),p.controller.loadCity()},check:function(e){return r.city.getId(e)}},o.PVZ={get:function(e){return r.PVZ.getCityPVZ(e)},check:function(e){return r.PVZ.check(e)}},o.cargo={add:function(e){a.add(e)},reset:function(){a.reset()},get:function(){return a.get()}},o.calculate=function(){return c.calculate(),c.profiles},o.options.get("link")||(o.open=function(){p.controller.open()},o.close=function(){p.controller.close()}),o}